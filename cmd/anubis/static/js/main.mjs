(()=>{function m(n,l=5,e=navigator.hardwareConcurrency){return new Promise((t,d)=>{let i=URL.createObjectURL(new Blob(["(",f(),")()"],{type:"application/javascript"})),s=[];for(let u=0;u<e;u++){let o=new Worker(i);o.onmessage=r=>{s.forEach(a=>a.terminate()),o.terminate(),t(r.data)},o.onerror=r=>{o.terminate(),d()},o.postMessage({data:n,difficulty:l,nonce:1e6*u}),s.push(o)}URL.revokeObjectURL(i)})}function f(){return function(){let n=e=>{let t=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",t.buffer)};function l(e){return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}addEventListener("message",async e=>{let t=e.data.data,d=e.data.difficulty,i,s=e.data.nonce||0;for(;;){let u=await n(t+s++),o=new Uint8Array(u),r=!0;for(let a=0;a<d;a++){let c=Math.floor(a/2),w=a%2;if((o[c]>>(w===0?4:0)&15)!==0){r=!1;break}}if(r){i=l(o),console.log(i);break}}s-=1,postMessage({hash:i,data:t,difficulty:d,nonce:s})})}.toString()}var p=(n="",l={})=>{let e=new URL(n,window.location.href);return Object.entries(l).forEach(t=>{let[d,i]=t;e.searchParams.set(d,i)}),e.toString()},h=n=>`/.within.website/x/cmd/anubis/static/img/${n}.webp`;(async()=>{let n=document.getElementById("status"),l=document.getElementById("image"),e=document.getElementById("title"),t=document.getElementById("spinner"),d=JSON.parse(document.getElementById("anubis_version").textContent);n.innerHTML="Calculating...";let{challenge:i,difficulty:s}=await fetch("/.within.website/x/cmd/anubis/api/make-challenge",{method:"POST"}).then(c=>{if(!c.ok)throw new Error("Failed to fetch config");return c.json()}).catch(c=>{throw e.innerHTML="Oh no!",n.innerHTML=`Failed to fetch config: ${c.message}`,l.src=h("sad"),t.innerHTML="",t.style.display="none",c});n.innerHTML=`Calculating...<br/>Difficulty: ${s}`;let u=Date.now(),{hash:o,nonce:r}=await m(i,s),a=Date.now();console.log({hash:o,nonce:r}),e.innerHTML="Success!",n.innerHTML=`Done! Took ${a-u}ms, ${r} iterations`,l.src=h(`happy?cacheBuster=${d}`),t.innerHTML="",t.style.display="none",setTimeout(()=>{let c=window.location.href;window.location.href=p("/.within.website/x/cmd/anubis/api/pass-challenge",{response:o,nonce:r,redir:c,elapsedTime:a-u})},250)})();})();
//# sourceMappingURL=main.mjs.map
